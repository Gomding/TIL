# 다른 개발자와 코드 계약

챕터 내용
- 다른 개발자들이 코드와 어떻게 상호작용 하는지
- 코드 계약과 코드 계약의 세부 조항
- `세부 조항을 최소화 <-> 오용과 예측을 벗어나는 코드를 예방` 의 관계
- 세부 조항을 피할 수 없다면 체크와 어서션을 어떻게 사용할 수 있는가?

`예측 가능한 코드 작성`, `코드를 오용하기 어렵게 만들라` 두 원칙은 개발자들이 다른 사람이 작성한 코드와 상호작용할 때 일어날 수 있는 일과 관련이 있음.

## 자신의 코드와 다른 개발자의 코드

- 개발자들이 코드베이스에 계속해서 수정을 가하면 그 코드베이스는 활동이 활발하게 일어나는 코드베이스가 된다.
- 중요한 코드(핵심 로직)을 그곳에 두면 깨지고 부서지기 쉽다. 
- 코드의 품질이 유지되려면 코드가 튼튼하고 사용하기 쉬워야 한다.
- 고품질 코드를 작성할 때 가장 중요한 고려 사항
  - 다른 개발자가 변경하거나 코드와 상호작용할 때 발생할 수 있는 문제가 없는가?
  - 발생한다면 그 문제를 어떻게 완화할 수 있을지를 이해하고 선제적 조치
- 코드를 작성할 때 다음 세 가지를 고려하면 유용
  1. 자신에게 명백하다고 해서 다른 사람에게도 명백한 것은 아니다.
  2. 다른 개발자는 무의식중에 여러분의 코드를 망가뜨릴 수 있다.
  3. 시간이 지남에 따라 자신의 코드를 기억하지 못한다.

#### 자신에게 명백하다고 해서 다른 사람에게도 명백한 것은 아니다.

- 자신의 로직에 너무 익숙해서 모든 것이 분명해 보이기 때문에 어떤것이 왜 그런 방식인지, 문제를 왜 그 방식으로 해결하고 있는지에 대해서는 거의 생각하지 않아도 될 것이다.
- 내가 코드를 작성할 당시에 너무나 분명해 보였던 것들이 다른 개발자에게는 분명하지 않을 것이다.
- 항상 코드가 `어떻게 사용되어야 하는지`, `무엇을 하는지`, `왜 그 일을 하고 있는지 설명하는 것`들이 유용하다.
- 코드는 주석문이 아닌 코드 자체로 이해하기 쉽고 설명이 되게 하는 것이 좋은 방법이다.
  - 주석을 사용하지 말라는 것이 아님. 주석이 필요한 부분에만 적절하게 사용해야한다.

#### 다른 개발자는 무의식중에 여러분의 코드를 망가뜨릴 수 있다.

- 내가 작성한 코드는 독집적으로 존재하지 않는다.
- 끊임없이 변화하는 코드 위에 놓여있고, 우리의 코드를 기반으로 계속해서 변화하는 코드 역시 끊임없이 작성된다.
- 내 코드는 자신에게 가장 중요할지 모르지만 다른 개발자들은 아마 그것에 대해 잘 알지 못할 것이다
- 다른 개발자가 코드를 접할 때 그 코드가 왜 존재하는지 혹은 무슨 일을 수행하는지에 대한 사전 지식을 가지고 있지 않을 수 있다.
- 결국 다른 개발자가 의도치 않게 **잘 실행되던 코드를 작동하지 않게 하거나 오용하는 방식으로 코드를 추가하거나 수정할 가능성이 크다**

변경한 코드에 문제가 있다면 코드 베이스에 병합되면 안 된다.
- 이를 방지하기 위한 두 가지 방법
  - 무언가 문제가 있을 때 코드 컴파일이 중지되거나 테스트가 실패하도록 만드는 것

#### 시간이 지나면 자신의 코드를 기억하지 못한다.

- 코드의 세부 사항은 작성 당시에 너무나 신선하고 중요하게 여겨서 결코 잊지 않을거라 생각한다.
- 시간이 지나면 그것들을 잊기 시작한다.
- 1~2년 후에는 다른 사람이 작성한 코드를 보는 것과 크게 다르지 않다.
- 배경지식이 없는 사람에게도 자신의 코드가 이해하기 쉬워야 하고, 잘 작동하던 코드에 버그가 발생하는 것이 어려워야 한다.

### 우리가 작성한 코드의 사용법을 다른 사람들은 어떻게 아는가?
- 코드가 무슨 일을 하는지와 사용법을 파악하기 위해서는 아래와 같은 사항을 이해해야 함
  - 여러 가지 상황에서 어떤 함수를 호출해야 하는지
  - 클래스가 무엇을 나타내는지 그리고 언제 사용되어야 하는지
  - 어떤 값을 인수로 사용해야 하는지
  - 코드가 수행하는 동작이 무엇인지
  - 어떤 값을 반환하는지

앞에서 이야기했듯이 자신이 작성한 코드라도 1년 후에는 다른 개발자가 작성한 코드라고 간주해야 한다.
코드를 어떻게 사용해야하는지 알아내기 위해 다른 개발자가 할 수 있는 일은 다음과 같다.
- 함수, 클래스 열거형 등의 **이름**을 살펴본다
- 함수와 생성자의 `매개변수 유형` 또는 `반환값의 유형`같은 **데이터 유형**을 살펴본다
- 함수/클래스 수준의 **문서/주석문**을 읽어본다.
- **직접** 묻거나 **채팅/이메일**을 통해 문의한다.
- 작성한 함수와 클래스의 **자세한 구현 코드**를 읽는다

#### 이름 확인

어떻게 사용해야 하는지에 대해 가장 잘 전달할 수 있는 방법으로 이름을 잘 짓는것!

#### 데이터 유형 확인

데이터 유형을 확인하는 것 역시 다른 개발자로 하여금 자신의 코드를 올바르게 사용하도록 하기 위한 매우 신뢰할 만한 방법

#### 문서 읽기

문서는 두 가지 이상의 형태로 존재할 수 있음
- 함수 및 클래스 수준의 비공식적인 주석문
- 자바독(JavaDoc)과 같은 좀 더 공식적인 코드 내 문서
- 외부 문서(README.md, 웹 페이지, 지침 문서 등)

문서는 유용하지만 신뢰도가 높지않다.
- 다른 개발자가 읽을 것이라는 보장이 없으며 실제로 읽지 않을 때가 많다.
- 잘못 해석할 수 있는 여지가 있다.
  - 다른 개발자에게 익숙하지 않은 용어 사용
  - 지식의 수준이나 정도에 대해 잘못 가정하고 문서를 작성
- 문서의 업데이트가 제대로 안 될 수 있다.
  - 코드가 변경할 때마다 문서를 업데이트 해야하는데 이것을 잊어버리면 코드에 대한 문서의 내용이 더 이상 유효하지 않게된다.

#### 직접 물어보기

- 질문하고 답하는 데 많은 시간을 써야 한다.
- 코드 작성자가 휴가를 간다면 물어볼 수 없다.
- 1년이 지나면 작성자도 코드를 상세하게 기억하지 못한다.
- 코드를 작성한 사람이 회사를 떠나면..?

#### 코드를 살펴보는 것

코드 세부사항을 살펴보는 것은 확실한 답이지만 코드의 양이 많으면 효과를 얻기 힘들다.
즉, 실용성이 떨어진다.

추상화 계층을 만드는데 있어 요점은 개발자가 한 번에 몇 가지 개념만 처리해야 하고,
그 문제가 어떻게 해결되었는지 알지 못해서 하위 문제에 대한 해결책을 사용할 수 있어야 한다는 것이다.
- 코드를 사용하는 방법을 알기 위해 개발자가 구현 세부사항을 읽어야한다면 이는 추상화 계층의 많은 이점을 부정하는 것

## 코드 계약

**계약에 의한 프로그래밍** 또는 **계약에 의한 디자인**
- 다른 사람들이 어떻게 코드를 사용할지 그리고 코드가 무엇을 할 것으로 기대할 수 있는지에 대한 것
- 서로 다른 코드 간의 상호 작용을 마치 계약처럼 생각한다.

코드 계약에 대한 용어
- 선결 조건 : 코드를 호출하기 전에 사실이어야 하는 것
- 사후 조건 : 코드가 호출된 후에 사실이어야 하는 것
- 불변 사항 : 코드가 호출되기 전과 후에 시스템 상태를 비교해서 변경되지 않아야 하는 사항

우리가 작성하는 코드는 어떤 종류의 계약을 맺는 것으로 볼 수 있다.
- 입력 매개변수가 있는 함수 작성
- 값을 반환
- 어떤 상태를 수정

코드를 호출하는 사람에게 무언가를 설정하거나 입력(선결 조건)을 제공해야 할 요건을 부여하고, 호출 결과 일어날 일 혹은 반환될 값(사후 조건)에 대한 기대를 갖게 하기 때문

개발자가 계약의 일부 혹은 모든 조건을 알지 못하면 코드 계약에 문제가 발생한다.
어떻게 하면 코드를 사용하는 사람이 계약을 파악하고 따라갈 수 있을지에 대해 생각하는 것이 중요

코드에서 계약을 정의할 때도 명확한 부분과 세부 조항이 있다.
- 계약이 명확한 부분
  - 함수와 클래스 이름: 호출하는 쪽에서 이것을 모르면 코드를 사용할 수 없다.
  - 인자 유형: 호출하는 쪽에서 인자의 유형을 잘못 사용하면 코드는 컴파일조차 되지 않는다.
  - 반환 유형: 호출하는 쪽에서 함수의 반환 유형을 알아야 한다.
  - 검사 예외: 호출하는 코드가 이것을 처리하지 않으면 컴파일되지 않는다
- 세부 조항
  - 주석문과 문서: 꼼꼼하게 읽어봐야 하는 것이지만 실제로는 잘 읽지 않음.
  - 비검사 예외: 주석문에 이 예외가 나열되어 있다면 이것은 세부 조항이다.(세부 조항에 없을 수도 있다..)

#### 세부 조항에 너무 의존하지 말라

세부 조항에 의존하는 것을 피할 수 없는 경우도 있다. 어떤 문제들은 항상 주의 사항이 있고 이것을 설명해야 한다.

어쩔 수 없이 다른 사람이 작성한 저품질의 코드에 의존해야 할 때도 있다.   
(이 때는 자신의 코드가 약간 이상하게 동작할 수 밖에 없다.)   
이런 상황을 설명하는 문서화된 세부 조항이 필요하고 다른 개발자들이 이 문서를 읽도록 해야한다.

메서드가 순차적으로 호출해야 하는 것도 세부 조항이다
- 코드를 올바르게 사용하기 위해 세부 조항에 의존하기 보다 잘못된 일을 하는 것을 처음부터 불가능하게 만드는 것이 좋다.
  - 스쿠터 렌탈 서비스에서 시속 30km/h 를 넘어가면 모터가 고장날 수 있어 벌금이 부과된다. (X)
  - 스쿠터 렌탈 서비스에서 시속 30km/h 에 도달하면 스쿠터는 더이상 속력을 올릴 수 없어진다. (O)